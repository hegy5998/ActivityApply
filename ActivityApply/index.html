<!--放置分頁內容的地方，會被放在ID=hiddenresult的裡面-->

<script>
    $(document).ready(function () {
        //產生所有活動
        getActivityAllList();
    })
    function getActivityAllList() {
        $.ajax({
            type: 'post',
            traditional: true,
            //傳送資料到後台為getActivityAllList的function
            url: '/index.aspx/getActivityAllList',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async:false,
            //成功時
            success: function (result) {
                // 加入活動
                addActivity(result.d);
            },
            //失敗時
            error: function () {
                return false;
            }
        });

    }
    function addActivity(ActivityInfo) {
        //轉換活動的JSON字串成JSON物件
        var ActivityInfo = JSON.parse(ActivityInfo);
        //產生場次
        for (var count = 0 ; count < ActivityInfo.length ; count++) {
            $("#hiddenresult").append('<div class="result">\
                                            <div class="row">\
                                                <div class="content-panel">\
                                                    <h3><a target="_self" href="activity.aspx?act_idn=' + ActivityInfo[count].act_idn + '">' + ActivityInfo[count].act_title + '</a></h3>\
                                                    <label>活動日期：' + dateReviver(ActivityInfo[count].as_date_start) + ' ~ ' + dateReviver(ActivityInfo[count].as_date_end) + '</label>\
                                                    <br />\
                                                    <label>報名日期：' + dateReviver(ActivityInfo[count].as_apply_start) + ' ~ ' + dateReviver(ActivityInfo[count].as_apply_end) + '</label>\
                                                </div>\
                                            </div>\
                                        </div>');
        }
        //後臺轉換DateTime格式時會把他轉成字串，使用JSON.parse會把它當成子串解析，需要在做轉換與切割成我們要的格式
        function dateReviver(datavalue) {
            if (datavalue != null) {
                var datavalue = datavalue.split("T");
                return datavalue[0] + " " + datavalue[1].substring(0, 5);
            }
            else
                return "";
        };
    }
</script>